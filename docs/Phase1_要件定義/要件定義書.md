# 補給管理システム 要件定義書

## 1. システム概要

### 1.1 目的
本システムは、組織内の補給品の在庫管理を効率化し、入出庫の記録と在庫状況の可視化を実現することを目的とする。また、Java/Spring Boot、React/TypeScriptの学習教材としても活用する。

### 1.2 適用範囲
- 補給品マスタデータの管理
- 在庫の入出庫記録
- 在庫状況の照会・分析
- CSV/Excelによるデータ入出力

### 1.3 ユーザー
- 補給担当者：日常的な入出庫作業、在庫照会
- 管理者：マスタデータ管理、データ分析、システム設定

---

## 2. 機能要件

### 2.1 補給品マスタ管理機能

#### 2.1.1 補給品一覧表示（FR-001）
**目的:** 登録されている補給品の一覧を表示する

**入力:**
- 検索条件（任意）：品名、カテゴリ

**処理:**
- データベースから補給品情報を取得
- 検索条件に合致するデータを抽出
- 一覧形式で表示（ページング対応）

**出力:**
- 補給品一覧
  - ID、品名、現在庫数、単価、カテゴリ、最終更新日時

**画面操作:**
- 詳細表示ボタン → 補給品詳細画面へ遷移
- 編集ボタン → 補給品編集画面へ遷移
- 削除ボタン → 削除確認後、データ削除
- 新規登録ボタン → 補給品登録画面へ遷移

#### 2.1.2 補給品詳細表示（FR-002）
**目的:** 選択した補給品の詳細情報を表示する

**入力:**
- 補給品ID

**処理:**
- データベースから補給品詳細を取得
- 関連する入出庫履歴を取得

**出力:**
- 補給品詳細情報
- 最近の入出庫履歴（直近10件）

#### 2.1.3 補給品登録（FR-003）
**目的:** 新規補給品をマスタに登録する

**入力項目:**
- 品名（必須、最大100文字）
- 初期在庫数（必須、0以上の整数）
- 単価（必須、0以上の数値、小数点以下2桁）
- カテゴリ（必須、選択式）

**バリデーション:**
- 品名：未入力不可、重複チェック
- 在庫数：数値チェック、0以上
- 単価：数値チェック、0以上
- カテゴリ：未選択不可

**処理:**
- 入力値の検証
- データベースへの登録
- 作成日時・更新日時の自動設定

**出力:**
- 登録完了メッセージ
- 補給品一覧画面へ遷移

#### 2.1.4 補給品更新（FR-004）
**目的:** 既存補給品の情報を更新する

**入力:**
- 補給品ID
- 更新項目（品名、単価、カテゴリ）
  ※在庫数は入出庫機能でのみ変更可能

**処理:**
- 入力値の検証
- データベースの更新
- 更新日時の自動更新

**出力:**
- 更新完了メッセージ

#### 2.1.5 補給品削除（FR-005）
**目的:** 不要な補給品をマスタから削除する

**入力:**
- 補給品ID

**処理:**
- 削除確認ダイアログ表示
- 入出庫履歴の有無をチェック
- データベースから削除（論理削除または物理削除）

**制約:**
- 入出庫履歴が存在する場合は削除不可（警告表示）

**出力:**
- 削除完了メッセージ

---

### 2.2 在庫管理機能

#### 2.2.1 在庫一覧表示（FR-006）
**目的:** 現在の全補給品の在庫状況を一覧表示する

**入力:**
- 検索条件（任意）：カテゴリ、在庫数範囲

**処理:**
- データベースから在庫情報を取得
- 在庫数でソート可能

**出力:**
- 在庫一覧
  - 品名、カテゴリ、現在庫数、単価、在庫金額（在庫数×単価）
- 合計在庫金額

**表示オプション:**
- 在庫切れ警告表示（在庫数が閾値以下）

#### 2.2.2 入庫登録（FR-007）
**目的:** 補給品の入庫を記録し、在庫数を増やす

**入力項目:**
- 補給品（必須、選択式）
- 入庫数量（必須、1以上の整数）
- 入庫日（必須、日付選択）
- 備考（任意、最大500文字）

**処理:**
- 補給品の在庫数に入庫数量を加算
- 入出庫履歴テーブルに記録
- トランザクション処理（在庫更新と履歴登録を同時実行）

**出力:**
- 入庫完了メッセージ
- 更新後の在庫数表示

#### 2.2.3 出庫登録（FR-008）
**目的:** 補給品の出庫を記録し、在庫数を減らす

**入力項目:**
- 補給品（必須、選択式）
- 出庫数量（必須、1以上の整数）
- 出庫日（必須、日付選択）
- 備考（任意、最大500文字）

**バリデーション:**
- 出庫数量が現在庫数を超えないこと

**処理:**
- 在庫数チェック
- 補給品の在庫数から出庫数量を減算
- 入出庫履歴テーブルに記録

**出力:**
- 出庫完了メッセージ
- 更新後の在庫数表示
- 在庫不足警告（必要に応じて）

#### 2.2.4 入出庫履歴照会（FR-009）
**目的:** 過去の入出庫記録を照会する

**入力:**
- 検索条件（任意）
  - 期間（開始日～終了日）
  - 補給品
  - 取引種別（入庫/出庫）

**処理:**
- データベースから履歴を取得
- 検索条件に合致するデータを抽出

**出力:**
- 入出庫履歴一覧
  - 日付、補給品名、種別、数量、備考
- CSVエクスポート機能

---

### 2.3 ファイル入出力機能

#### 2.3.1 CSVインポート（FR-010）
**目的:** CSVファイルから補給品データを一括登録する

**入力:**
- CSVファイル
  - フォーマット：品名,数量,単価,カテゴリ
  - 文字コード：UTF-8
  - 最大行数：1000行

**処理:**
- ファイル形式の検証
- CSVデータの解析
- 各行のバリデーション
- データベースへの一括登録（トランザクション処理）

**エラー処理:**
- フォーマットエラー：エラー行を表示
- データエラー：エラー内容を一覧表示
- エラー発生時は全てロールバック

**出力:**
- 登録件数
- エラー一覧（該当する場合）

#### 2.3.2 Excelエクスポート（FR-011）
**目的:** 補給品一覧をExcel形式でエクスポートする

**入力:**
- エクスポート対象（全件または検索結果）

**処理:**
- データベースからデータを取得
- Excelファイルを生成
  - シート名：補給品一覧
  - ヘッダー行：項目名
  - データ行：補給品情報

**出力:**
- Excelファイル（.xlsx形式）
  - ファイル名：補給品一覧_YYYYMMDD.xlsx

---

### 2.4 共通機能

#### 2.4.1 エラーハンドリング（FR-012）
- バリデーションエラー：フィールド単位でエラー表示
- システムエラー：エラーメッセージとログ記録
- ネットワークエラー：再試行可能な旨を表示

#### 2.4.2 操作確認（FR-013）
- 削除操作：確認ダイアログ表示
- 一括操作：影響範囲と確認ダイアログ表示

---

## 3. 非機能要件

### 3.1 性能要件

#### 3.1.1 応答時間
- 画面表示：3秒以内
- データ登録・更新：2秒以内
- 検索処理：5秒以内
- ファイルエクスポート：データ件数に依存（1000件で10秒以内）

#### 3.1.2 スループット
- 同時接続ユーザー数：10ユーザー（学習用のため最小限）
- トランザクション処理：秒間10件

### 3.2 可用性要件

#### 3.2.1 稼働時間
- 開発・学習用のため、特定の稼働時間要件なし
- 必要時に起動・停止可能な構成

#### 3.2.2 データバックアップ
- H2データベースのファイルバックアップ（手動）
- エクスポート機能によるデータ保存

### 3.3 セキュリティ要件

#### 3.3.1 認証・認可
- フェーズ1では認証機能は実装しない（学習優先）
- 将来的にSpring Securityによる認証機能を追加予定

#### 3.3.2 データ保護
- SQLインジェクション対策（MyBatisのパラメータバインディング使用）
- XSS対策（Reactのデフォルト機能で対応）
- CSRF対策（Spring Securityで対応予定）

#### 3.3.3 入力値検証
- クライアント側バリデーション（React）
- サーバー側バリデーション（Spring Boot）
- 二重チェック体制

### 3.4 保守性要件

#### 3.4.1 ログ出力
- アプリケーションログ：INFO、WARN、ERROR
- エラーログ：スタックトレース含む
- ログローテーション：サイズベース（10MB）

#### 3.4.2 コード品質
- コーディング規約準拠（Google Java Style Guide、Airbnb JavaScript Style Guide）
- コメント記載（クラス、メソッド単位）
- TypeScriptの型定義による型安全性確保

### 3.5 移植性要件

#### 3.5.1 プラットフォーム
- OS：Windows、macOS、Linux（WSL含む）
- ブラウザ：Chrome、Firefox、Edge（最新版）

#### 3.5.2 データベース
- 開発環境：H2 Database
- 本番環境想定：PostgreSQL、MySQL（将来的な移行を考慮した設計）

### 3.6 ユーザビリティ要件

#### 3.6.1 操作性
- 直感的なUI設計
- レスポンシブデザイン（デスクトップ優先）
- 操作フィードバック（ローディング表示、完了メッセージ）

#### 3.6.2 アクセシビリティ
- キーボード操作対応
- エラーメッセージの明確な表示

---

## 4. 制約条件

### 4.1 技術的制約
- Java 17以上必須
- Spring Boot 3.x系使用
- React 18.x系使用
- H2 Databaseを開発DBとして使用

### 4.2 プロジェクト制約
- 学習目的のため、段階的な機能実装
- 認証機能は初期フェーズでは非実装
- 単一ユーザーでの利用を想定

### 4.3 環境制約
- 開発環境：WSL + VSCode
- デプロイ環境：Apache Tomcat
- ローカル環境での動作を前提

---

## 5. 前提条件

### 5.1 システム前提
- インターネット接続（パッケージダウンロード時）
- Java 17がインストール済み
- Node.js 18以上がインストール済み

### 5.2 データ前提
- 初期データは手動またはCSVで投入
- マスタデータは正確性を担保

### 5.3 運用前提
- 開発・学習用のため、24時間稼働は不要
- データバックアップは手動実行

---

## 6. システム構成

### 6.1 アーキテクチャ
```
[ブラウザ] ← HTTP → [React App (Vite)] ← REST API → [Spring Boot] ← MyBatis → [H2 Database]
```

### 6.2 開発環境
- OS：WSL (Ubuntu)
- エディタ：VSCode
- バージョン管理：Git

### 6.3 ネットワーク構成
- バックエンド：localhost:8080
- フロントエンド：localhost:5173
- H2 Console：localhost:8080/h2-console
- Swagger UI：localhost:8080/swagger-ui.html

---

## 7. 画面一覧

| 画面ID | 画面名 | 概要 | 関連機能 |
|--------|--------|------|----------|
| SC-001 | ダッシュボード | システムTOP画面、サマリー表示 | - |
| SC-002 | 補給品一覧 | 補給品マスタ一覧表示 | FR-001 |
| SC-003 | 補給品詳細 | 補給品の詳細情報表示 | FR-002 |
| SC-004 | 補給品登録 | 新規補給品登録フォーム | FR-003 |
| SC-005 | 補給品編集 | 補給品情報編集フォーム | FR-004 |
| SC-006 | 在庫一覧 | 在庫状況一覧表示 | FR-006 |
| SC-007 | 入庫登録 | 入庫情報入力フォーム | FR-007 |
| SC-008 | 出庫登録 | 出庫情報入力フォーム | FR-008 |
| SC-009 | 入出庫履歴 | 入出庫履歴一覧・検索 | FR-009 |
| SC-010 | ファイルインポート | CSV一括登録画面 | FR-010 |

---

## 8. データベース設計（概要）

### 8.1 テーブル一覧

#### supplies（補給品マスタ）
| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 補給品ID |
| name | VARCHAR(100) | NOT NULL, UNIQUE | 品名 |
| quantity | INT | NOT NULL, DEFAULT 0 | 在庫数 |
| unit_price | DECIMAL(10,2) | NOT NULL | 単価 |
| category | VARCHAR(50) | NOT NULL | カテゴリ |
| created_at | TIMESTAMP | NOT NULL | 作成日時 |
| updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### inventory_transactions（入出庫履歴）
| カラム名 | 型 | 制約 | 説明 |
|----------|-----|------|------|
| id | BIGINT | PK, AUTO_INCREMENT | 履歴ID |
| supply_id | BIGINT | FK, NOT NULL | 補給品ID |
| type | VARCHAR(10) | NOT NULL | IN/OUT |
| quantity | INT | NOT NULL | 数量 |
| transaction_date | TIMESTAMP | NOT NULL | 取引日時 |
| note | VARCHAR(500) | NULL | 備考 |

---

## 9. 開発スケジュール（例）

### フェーズ1：基盤構築（1-2週間）
- プロジェクト環境構築
- スケルトンコード生成
- データベース設計・構築

### フェーズ2：基本機能実装（2-3週間）
- 補給品マスタCRUD機能
- 在庫一覧表示
- 基本的なUI実装

### フェーズ3：在庫管理機能（1-2週間）
- 入出庫登録機能
- 履歴照会機能

### フェーズ4：ファイル入出力（1週間）
- CSVインポート
- Excelエクスポート

### フェーズ5：テスト・改善（1週間）
- 統合テスト
- UI/UX改善
- ドキュメント整備

---

## 10. 付録

### 10.1 用語集
- **CRUD:** Create（登録）、Read（参照）、Update（更新）、Delete（削除）の略
- **MyBatis:** JavaのO/Rマッピングフレームワーク
- **REST API:** HTTPを利用したWebサービスのアーキテクチャスタイル
- **DTO:** Data Transfer Object - レイヤー間でデータを転送するためのオブジェクト
- **Entity:** データベースのテーブルに対応するドメインモデル
- **Mapper:** MyBatisでSQLとJavaメソッドをマッピングするインターフェース

### 10.2 参考資料
- Spring Boot公式ドキュメント: https://spring.io/projects/spring-boot
- React公式ドキュメント: https://react.dev/
- MyBatis公式ドキュメント: https://mybatis.org/mybatis-3/
- TypeScript公式ドキュメント: https://www.typescriptlang.org/

---

## 改訂履歴

| 版数 | 日付 | 作成者 | 変更内容 |
|------|------|--------|----------|
| 1.0 | 2024-12-16 | - | 初版作成 |