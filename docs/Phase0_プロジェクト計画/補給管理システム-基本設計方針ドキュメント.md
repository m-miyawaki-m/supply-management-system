# 補給管理システム - 基本設計方針ドキュメント

## 1. ドキュメント概要

### 1.1 目的
本ドキュメントは、補給管理システムの基本設計を体系的に作成するための方針と各設計書の構成を定義する。

### 1.2 対象読者
- 開発者（バックエンド・フロントエンド）
- システム設計者
- プロジェクト管理者

### 1.3 関連ドキュメント
- 開発環境構築ドキュメント (development-environment-setup.md)
- 要件定義書 (requirements-specification.md)

---

## 2. 基本設計の全体構成

### 2.1 設計書一覧

| No | 設計書名 | ファイル名 | 作成優先度 | 概要 |
|----|---------|-----------|-----------|------|
| 1 | システム構成設計書 | system-architecture-design.md | 最優先 | システム全体のアーキテクチャと技術構成 |
| 2 | 画面設計書 | screen-design.md | 高 | UI/UX、画面遷移、レイアウト仕様 |
| 3 | API設計書 | api-design.md | 高 | REST APIのインターフェース仕様 |
| 4 | データベース設計書 | database-design.md | 高 | テーブル定義、ER図、SQL仕様 |
| 5 | クラス設計書 | class-design.md | 中 | バックエンド・フロントエンドのクラス構造 |
| 6 | 共通機能設計書 | common-feature-design.md | 中 | エラーハンドリング、バリデーション等 |

### 2.2 設計書間の依存関係
```
システム構成設計書（基盤）
    ↓
    ├→ 画面設計書 ────┐
    ├→ API設計書 ─────┤→ クラス設計書
    └→ データベース設計書 ┘
                ↓
          共通機能設計書（横断）
```

---

## 3. 各設計書の目次構成

### 3.1 システム構成設計書 (system-architecture-design.md)
```markdown
# システム構成設計書

## 1. 概要
### 1.1 目的
### 1.2 適用範囲
### 1.3 前提条件

## 2. システムアーキテクチャ
### 2.1 論理アーキテクチャ
### 2.2 物理アーキテクチャ
### 2.3 レイヤー構成
### 2.4 通信プロトコル

## 3. 技術スタック詳細
### 3.1 バックエンド技術
### 3.2 フロントエンド技術
### 3.3 データベース技術
### 3.4 ミドルウェア・ライブラリ

## 4. 環境構成
### 4.1 開発環境
### 4.2 テスト環境
### 4.3 本番環境（想定）

## 5. セキュリティアーキテクチャ
### 5.1 認証・認可方式
### 5.2 通信セキュリティ
### 5.3 データ保護

## 6. 非機能要件への対応
### 6.1 性能設計
### 6.2 可用性設計
### 6.3 保守性設計

## 7. デプロイメント構成
### 7.1 デプロイ方式
### 7.2 起動・停止手順
### 7.3 環境変数・設定管理

## 付録
### A. ネットワーク構成図
### B. 使用ポート一覧
### C. 外部連携一覧
```

---

### 3.2 画面設計書 (screen-design.md)
```markdown
# 画面設計書

## 1. 概要
### 1.1 目的
### 1.2 設計方針
### 1.3 共通UI規約

## 2. 画面一覧
### 2.1 画面一覧表
### 2.2 画面遷移図

## 3. 共通レイアウト
### 3.1 ヘッダー
### 3.2 サイドバー
### 3.3 フッター
### 3.4 レスポンシブ対応

## 4. 画面詳細設計
### 4.1 SC-001: ダッシュボード
#### 4.1.1 画面概要
#### 4.1.2 ワイヤーフレーム
#### 4.1.3 画面項目定義
#### 4.1.4 画面操作フロー
#### 4.1.5 バリデーション
#### 4.1.6 エラーメッセージ

### 4.2 SC-002: 補給品一覧
[同様の構成を各画面で繰り返し]

### 4.3 SC-003: 補給品詳細
### 4.4 SC-004: 補給品登録
### 4.5 SC-005: 補給品編集
### 4.6 SC-006: 在庫一覧
### 4.7 SC-007: 入庫登録
### 4.8 SC-008: 出庫登録
### 4.9 SC-009: 入出庫履歴
### 4.10 SC-010: ファイルインポート

## 5. 共通コンポーネント設計
### 5.1 ボタン
### 5.2 入力フォーム
### 5.3 テーブル
### 5.4 モーダル
### 5.5 通知・メッセージ

## 6. バリデーション仕様
### 6.1 入力チェック一覧
### 6.2 エラーメッセージ一覧

## 付録
### A. カラーパレット
### B. タイポグラフィ
### C. アイコン一覧
```

---

### 3.3 API設計書 (api-design.md)
```markdown
# API設計書

## 1. 概要
### 1.1 目的
### 1.2 APIアーキテクチャ
### 1.3 設計方針

## 2. API共通仕様
### 2.1 ベースURL
### 2.2 HTTPメソッド規約
### 2.3 リクエストヘッダー
### 2.4 レスポンスヘッダー
### 2.5 ステータスコード
### 2.6 エラーレスポンス形式
### 2.7 ページング仕様
### 2.8 ソート仕様

## 3. エンドポイント一覧
### 3.1 補給品管理API
### 3.2 在庫管理API
### 3.3 ファイル操作API

## 4. API詳細仕様

### 4.1 補給品管理API

#### 4.1.1 GET /api/supplies - 補給品一覧取得
##### リクエスト
- HTTPメソッド
- URLパラメータ
- クエリパラメータ
##### レスポンス
- ステータスコード
- レスポンスボディ（JSON構造）
- サンプル
##### エラーレスポンス

#### 4.1.2 GET /api/supplies/{id} - 補給品詳細取得
[同様の構成を各エンドポイントで繰り返し]

#### 4.1.3 POST /api/supplies - 補給品登録
#### 4.1.4 PUT /api/supplies/{id} - 補給品更新
#### 4.1.5 DELETE /api/supplies/{id} - 補給品削除

### 4.2 在庫管理API
#### 4.2.1 GET /api/inventory - 在庫一覧取得
#### 4.2.2 POST /api/inventory/in - 入庫登録
#### 4.2.3 POST /api/inventory/out - 出庫登録
#### 4.2.4 GET /api/inventory/history - 入出庫履歴取得

### 4.3 ファイル操作API
#### 4.3.1 POST /api/supplies/import - CSVインポート
#### 4.3.2 GET /api/supplies/export - Excelエクスポート

## 5. データ型定義
### 5.1 共通型
### 5.2 補給品型
### 5.3 在庫トランザクション型

## 付録
### A. Swagger定義（OpenAPI 3.0）
### B. APIテストケース
### C. モックデータ
```

---

### 3.4 データベース設計書 (database-design.md)
```markdown
# データベース設計書

## 1. 概要
### 1.1 目的
### 1.2 データベース環境
### 1.3 設計方針

## 2. ER図
### 2.1 概念ER図
### 2.2 論理ER図
### 2.3 物理ER図

## 3. テーブル定義

### 3.1 supplies（補給品マスタ）
#### 3.1.1 テーブル概要
#### 3.1.2 カラム定義
| 物理名 | 論理名 | データ型 | 長さ | NULL | キー | デフォルト値 | 説明 |
|--------|--------|----------|------|------|------|--------------|------|
| id | 補給品ID | BIGINT | - | NOT NULL | PK | AUTO_INCREMENT | 主キー |
| ... | ... | ... | ... | ... | ... | ... | ... |

#### 3.1.3 制約条件
#### 3.1.4 インデックス定義
#### 3.1.5 関連テーブル

### 3.2 inventory_transactions（入出庫履歴）
[同様の構成]

## 4. テーブル関連
### 4.1 外部キー定義
### 4.2 参照整合性

## 5. データ設計
### 5.1 初期データ
### 5.2 マスタデータ
### 5.3 テストデータ

## 6. SQL命名規則
### 6.1 テーブル命名規則
### 6.2 カラム命名規則
### 6.3 インデックス命名規則
### 6.4 制約命名規則

## 7. パフォーマンス設計
### 7.1 インデックス戦略
### 7.2 パーティション設計（将来）
### 7.3 統計情報管理

## 付録
### A. DDL（schema.sql）
### B. 初期データ投入SQL（data.sql）
### C. データ移行手順
```

---

### 3.5 クラス設計書 (class-design.md)
```markdown
# クラス設計書

## 1. 概要
### 1.1 目的
### 1.2 設計方針
### 1.3 命名規約

## 2. バックエンド設計（Spring Boot）

### 2.1 パッケージ構成
```
com.example.supply/
├── controller/
├── service/
├── mapper/
├── dto/
├── entity/
├── config/
├── exception/
└── util/
```

### 2.2 レイヤー別設計

#### 2.2.1 Controller層
##### SupplyController
- クラス概要
- 主要メソッド一覧
- メソッド詳細仕様

#### 2.2.2 Service層
##### SupplyService
- クラス概要
- 主要メソッド一覧
- ビジネスロジック詳細

#### 2.2.3 Mapper層
##### SupplyMapper
- インターフェース概要
- メソッド一覧
- SQL対応

#### 2.2.4 Entity層
##### Supply
- クラス概要
- フィールド定義
- アノテーション

#### 2.2.5 DTO層
##### SupplyDto, SupplyFormDto
- クラス概要
- フィールド定義
- バリデーション

### 2.3 クラス図
### 2.4 シーケンス図
#### 補給品登録処理
#### 在庫更新処理

## 3. フロントエンド設計（React/TypeScript）

### 3.1 ディレクトリ構成
```
src/
├── components/
│   ├── common/
│   └── supply/
├── pages/
├── services/
├── types/
├── hooks/
└── utils/
```

### 3.2 コンポーネント設計

#### 3.2.1 Pageコンポーネント
##### SupplyManagement.tsx
- コンポーネント概要
- Props定義
- State定義
- 主要ロジック

#### 3.2.2 共通コンポーネント
##### Header.tsx, Sidebar.tsx, FileUpload.tsx
[同様の構成]

### 3.3 TypeScript型定義
#### Supply型
#### SupplyFormData型
#### API関連型

### 3.4 カスタムフック設計
#### useSupplies
- フック概要
- 引数・戻り値
- 状態管理

### 3.5 サービス層設計
#### supplyService.ts
- メソッド一覧
- API呼び出し詳細

## 4. 状態管理設計
### 4.1 ローカルState
### 4.2 Context API（将来）
### 4.3 状態遷移図

## 付録
### A. クラス一覧
### B. インターフェース一覧
### C. 型定義一覧
```

---

### 3.6 共通機能設計書 (common-feature-design.md)
```markdown
# 共通機能設計書

## 1. 概要
### 1.1 目的
### 1.2 適用範囲
### 1.3 設計方針

## 2. エラーハンドリング設計

### 2.1 エラー分類
#### 2.1.1 バリデーションエラー
#### 2.1.2 ビジネスロジックエラー
#### 2.1.3 システムエラー
#### 2.1.4 ネットワークエラー

### 2.2 エラーコード体系
| エラーコード | 分類 | メッセージ | HTTPステータス |
|-------------|------|-----------|---------------|
| E001 | バリデーション | 必須項目が未入力です | 400 |
| ... | ... | ... | ... |

### 2.3 バックエンドエラーハンドリング
#### 2.3.1 例外クラス設計
#### 2.3.2 GlobalExceptionHandler
#### 2.3.3 エラーレスポンス形式

### 2.4 フロントエンドエラーハンドリング
#### 2.4.1 Axiosインターセプター
#### 2.4.2 エラー表示コンポーネント
#### 2.4.3 エラー通知方式

## 3. バリデーション設計

### 3.1 バリデーション方針
#### 3.1.1 クライアント側バリデーション
#### 3.1.2 サーバー側バリデーション

### 3.2 共通バリデーションルール
| ルール名 | 検証内容 | エラーメッセージ |
|---------|---------|----------------|
| Required | 必須入力チェック | {項目名}は必須です |
| ... | ... | ... |

### 3.3 バックエンドバリデーション
#### 3.3.1 Bean Validation
#### 3.3.2 カスタムバリデーター

### 3.4 フロントエンドバリデーション
#### 3.4.1 React Hook Form（将来）
#### 3.4.2 カスタムバリデーション関数

## 4. ロギング設計

### 4.1 ログレベル定義
### 4.2 ログ出力方針
### 4.3 ログフォーマット
### 4.4 ログローテーション

## 5. ファイル入出力設計

### 5.1 CSVインポート仕様
#### 5.1.1 ファイルフォーマット
#### 5.1.2 パース処理
#### 5.1.3 バリデーション
#### 5.1.4 エラーハンドリング

### 5.2 Excelエクスポート仕様
#### 5.2.1 ファイルフォーマット
#### 5.2.2 テンプレート定義
#### 5.2.3 生成処理

## 6. ユーティリティ設計

### 6.1 日付処理ユーティリティ
### 6.2 ファイル処理ユーティリティ
### 6.3 文字列処理ユーティリティ
### 6.4 数値処理ユーティリティ

## 7. トランザクション制御

### 7.1 トランザクション境界
### 7.2 トランザクション分離レベル
### 7.3 ロールバック方針

## 8. 共通定数定義

### 8.1 ステータスコード
### 8.2 カテゴリマスタ
### 8.3 メッセージ定義

## 付録
### A. エラーメッセージ一覧
### B. 共通クラス一覧
### C. 設定ファイルサンプル
```

---

## 4. 設計書作成の進め方

### 4.1 推奨作成順序
```
Phase 1: 基盤設計（1週目）
  1. システム構成設計書 ← 全体像の把握
  2. データベース設計書 ← データ構造の確定

Phase 2: インターフェース設計（2週目）
  3. API設計書 ← フロント・バック連携
  4. 画面設計書 ← UI/UX設計

Phase 3: 実装設計（3週目）
  5. クラス設計書 ← 実装構造の詳細化
  6. 共通機能設計書 ← 横断的機能（並行可）
```

### 4.2 レビューポイント

各設計書作成時のチェックポイント：

**システム構成設計書:**
- [ ] 要件定義の非機能要件を満たしているか
- [ ] 技術スタックが開発環境と整合しているか
- [ ] デプロイ手順が明確か

**画面設計書:**
- [ ] 要件定義の全画面をカバーしているか
- [ ] 画面遷移に矛盾がないか
- [ ] バリデーションルールが明確か

**API設計書:**
- [ ] RESTful設計になっているか
- [ ] エラーハンドリングが統一されているか
- [ ] 画面設計と整合しているか

**データベース設計書:**
- [ ] 正規化されているか
- [ ] 外部キー制約が適切か
- [ ] インデックスが適切に設定されているか

**クラス設計書:**
- [ ] レイヤー分離が適切か
- [ ] 責務が明確に分離されているか
- [ ] API/DB設計と整合しているか

**共通機能設計書:**
- [ ] エラーハンドリングが統一されているか
- [ ] バリデーションが二重チェックされているか
- [ ] ロギングが適切に設計されているか

### 4.3 設計書の管理

- **バージョン管理:** Git管理下に配置
- **更新ルール:** 設計変更時は必ず設計書を更新
- **命名規則:** `{設計書名}-v{バージョン}.md`
- **レビュー:** 各設計書完成時に相互レビュー実施

---

## 5. 設計原則

### 5.1 アーキテクチャ原則

1. **レイヤードアーキテクチャ:** Presentation、Business、Data Accessの3層分離
2. **疎結合:** 各レイヤー間はインターフェースで連携
3. **単一責任の原則:** 1クラス1責務
4. **DRY原則:** 重複コードを排除

### 5.2 コーディング原則

1. **命名規約遵守:** Java（Google Style）、TypeScript（Airbnb Style）
2. **型安全性:** TypeScriptの型定義を活用
3. **コメント記載:** クラス・メソッド単位で目的を記載
4. **テスタビリティ:** ユニットテスト可能な設計

### 5.3 データベース設計原則

1. **正規化:** 第3正規形まで正規化
2. **命名規則:** スネークケース、複数形は避ける
3. **制約定義:** NOT NULL、UNIQUE、FK制約を適切に設定
4. **インデックス:** 検索条件に使用するカラムにインデックス

---

## 6. ツール・テンプレート

### 6.1 使用ツール

- **ER図作成:** dbdiagram.io、MySQL Workbench
- **画面モックアップ:** Figma、Adobe XD
- **API設計:** Swagger Editor
- **クラス図:** PlantUML、draw.io

### 6.2 ドキュメントテンプレート

各設計書のテンプレートは本ドキュメントの「3. 各設計書の目次構成」を参照。

---

## 7. 改訂履歴

| 版数 | 日付 | 作成者 | 変更内容 |
|------|------|--------|----------|
| 1.0 | 2024-12-16 | - | 初版作成 |

---

## 付録

### A. 設計書チェックリスト

各設計書作成時の最終チェック項目：

- [ ] 要件定義との整合性確認
- [ ] 他設計書との整合性確認
- [ ] レビュー実施・指摘事項対応
- [ ] サンプルコード/図の添付
- [ ] 改訂履歴の記載

### B. 設計書作成時の参考資料

- Spring Boot公式ドキュメント
- React公式ドキュメント
- MyBatis公式ドキュメント
- RESTful API設計ベストプラクティス
- データベース設計の基礎